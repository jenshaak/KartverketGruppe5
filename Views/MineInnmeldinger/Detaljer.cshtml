@using KartverketGruppe5.Models
@model InnmeldingModel
@{
    ViewData["Title"] = "Innmelding Detaljer";
    var lokasjon = ViewBag.Lokasjon as LokasjonModel;
}

<div class="container mx-auto px-4 py-8 bg-green-200">
    <div class="mb-6">
        <a asp-action="Index" class="text-blue-600 hover:underline">← Tilbake til mine innmeldinger</a>
        <h1 class="text-3xl font-bold mt-4">Innmelding Detaljer</h1>
        <p class="text-gray-600">Opprettet: @Model.OpprettetDato.ToShortDateString()</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Informasjon</h2>
            <div class="space-y-4">
                <div class="flex flex-col">
                    <p class="font-medium">Kommune:</p>
                    <p>@Model.KommuneNavn</p>
                </div>
                <div>
                    <p class="font-medium">Beskrivelse:</p>
                    <p>@Model.Beskrivelse</p>
                </div>
                <div>
                    <p class="font-medium">Status:</p>
                    <span class="px-3 py-1 rounded-full @Model.StatusClass">@Model.Status</span>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow">
            <div id="map" style="height: 400px; width: 100%;"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        console.log('Lokasjon:', @Json.Serialize(lokasjon));
    </script>
    <script>
        // Vent til dokumentet er lastet
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser kartet
            var map = L.map('map');

            // Legg til kartlaget
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            @if (lokasjon != null)
            {
                <text>
                // Sett kartvisning til lokasjonens koordinater
                map.setView([@lokasjon.Latitude, @lokasjon.Longitude], 15);

                // Legg til markør
                var marker = L.marker([@lokasjon.Latitude, @lokasjon.Longitude]).addTo(map);
                marker.bindPopup('@Model.Beskrivelse').openPopup();

                @if (!string.IsNullOrEmpty(lokasjon.GeoJson))
                {
                    <text>
                    // Legg til GeoJSON hvis det finnes
                    var geoJsonLayer = L.geoJSON(@Html.Raw(lokasjon.GeoJson), {
                        style: function(feature) {
                            return {
                                color: "#ff7800",
                                weight: 3,
                                opacity: 0.65
                            };
                        }
                    }).addTo(map);
                    map.fitBounds(geoJsonLayer.getBounds());
                    </text>
                }
                </text>
            }
        });
    </script>
} 